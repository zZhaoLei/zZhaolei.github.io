<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Jenkins处理GitLab Hook | 俺的博客</title>
<meta name="keywords" content="Jenkins">
<meta name="description" content="jenkins安装Generic Webhook Trigger Plugin插件
{% asset_img Generic_Webhook_Trgger.png Generic\ Webhook\ Trgger具体配置 %}
创建任务，在构建触发器中勾选Generic Webhook Trigger, 在展开的页面中会有一个URL, 这个URL是配置Webhook使用的，一般形式是http://JENKINS_URL/generic-webhook-trigger/invoke, JENKINS_URL是初始配置jenkins时会有的，一般是http://IP:8080的形式。
如果之前有配置过GitLab webhook, 请去除这个，不然Generic Webhook Trigger不会生效。
如果Git仓库的验证使用的是用户名和密码，那么就不需要配置Token.
复制这个URL，将JENKINS_URL替换为自己的真实数据，在GitLab的对应的项目的设置--&gt;集成中输入，没有安全令牌，勾选自己需要的触发器事件，SSL证书验证可以开启，也可以不开启，推荐开启。
任务设置界面还有Post content parameters, Header parameters, Request parameters, 分别是请求的post数据，header头，请求头。
一般我们只需要post的数据里的内容就够了。
图片的3，4分别是变量名（3），值（4）。值是直接从post的json格式的数据中取出来的，注意，值的获取方式是JSONPath，并且里面有点，如果json数据有多层，那么就多点几次，比如$.project.name等，可以配置多个变量组。
我们还可以Generic Webhook Trigger配置Optional filter，设置一个触发事件，比如只有当你推送的分支是develop的时候，才去构建。
在Optional filter的Expression框中输入^(refs/heads/develop)$, 在下面的Text框中输入步骤3的变量名，这里写$ref。
在shell中使用变量名的方式也是直接使用，例如echo $ref， 注意没有点。
配置完成后，保存，可以点击刚刚配置的GitLab的webhook页面的Test对应的事件测试。
GitLab的push的hook数据：
{ &#34;object_kind&#34;: &#34;push&#34;, &#34;before&#34;: &#34;95790bf891e76fee5e1747ab589903a6a1f80f22&#34;, &#34;after&#34;: &#34;da1560886d4f094c3e6c9ef40349f7d38b5d27d7&#34;, &#34;ref&#34;: &#34;refs/heads/master&#34;, &#34;checkout_sha&#34;: &#34;da1560886d4f094c3e6c9ef40349f7d38b5d27d7&#34;, &#34;user_id&#34;: 4, &#34;user_name&#34;: &#34;John Smith&#34;, &#34;user_username&#34;: &#34;jsmith&#34;, &#34;user_email&#34;: &#34;john@example.com&#34;, &#34;user_avatar&#34;: &#34;https://s.gravatar.com/avatar/d4c74594d841139328695756648b6bd6?s=8://s.gravatar.com/avatar/d4c74594d841139328695756648b6bd6?s=80&#34;, &#34;project_id&#34;: 15, &#34;project&#34;:{ &#34;id&#34;: 15, &#34;name&#34;:&#34;Diaspora&#34;, &#34;description&#34;:&#34;&#34;, &#34;web_url&#34;:&#34;http://example.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/jenkins%E5%A4%84%E7%90%86gitlab-hook/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css" integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/jenkins%E5%A4%84%E7%90%86gitlab-hook/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="俺的博客 (Alt + H)">俺的博客</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tag">
                    <span>Tag</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Jenkins处理GitLab Hook
    </h1>
    <div class="post-meta"><span title='2019-06-01 10:07:00 +0800 CST'>June 1, 2019</span>&nbsp;·&nbsp;1 min

</div>
  </header> 

  <div class="post-content"><p><code>jenkins</code>安装<code>Generic Webhook Trigger Plugin</code>插件</p>
<p>{% asset_img Generic_Webhook_Trgger.png Generic\ Webhook\ Trgger具体配置 %}</p>
<p>创建任务，在<code>构建触发器中</code>勾选<code>Generic Webhook Trigger</code>, 在展开的页面中会有一个<code>URL</code>, 这个<code>URL</code>是配置<code>Webhook</code>使用的，一般形式是<code>http://JENKINS_URL/generic-webhook-trigger/invoke</code>, <code>JENKINS_URL</code>是初始配置<code>jenkins</code>时会有的，一般是<code>http://IP:8080</code>的形式。</p>
<p>如果之前有配置过<code>GitLab webhook</code>, 请去除这个，不然<code>Generic Webhook Trigger</code>不会生效。</p>
<p>如果<code>Git</code>仓库的验证使用的是用户名和密码，那么就不需要配置<code>Token</code>.</p>
<p>复制这个<code>URL</code>，将<code>JENKINS_URL</code>替换为自己的真实数据，在<code>GitLab</code>的对应的项目的<code>设置--&gt;集成</code>中输入，没有安全令牌，勾选自己需要的触发器事件，SSL证书验证可以开启，也可以不开启，推荐开启。</p>
<p>任务设置界面还有<code>Post content parameters</code>, <code>Header parameters</code>, <code>Request parameters</code>, 分别是请求的<code>post数据</code>，<code>header头</code>，<code>请求头</code>。</p>
<p>一般我们只需要<code>post</code>的数据里的内容就够了。</p>
<p>图片的3，4分别是<code>变量名（3）</code>，<code>值（4）</code>。值是直接从<code>post</code>的<code>json格式</code>的数据中取出来的，注意，值的获取方式是<code>JSONPath</code>，并且里面有<code>点</code>，如果<code>json</code>数据有多层，那么就多点几次，比如<code>$.project.name</code>等，可以配置多个变量组。</p>
<p>我们还可以<code>Generic Webhook Trigger</code>配置<code>Optional filter</code>，设置一个触发事件，比如只有当你推送的分支是<code>develop</code>的时候，才去构建。</p>
<p>在<code>Optional filter</code>的<code>Expression</code>框中输入<code>^(refs/heads/develop)$</code>, 在下面的<code>Text</code>框中输入<code>步骤3的变量名</code>，这里写<code>$ref</code>。</p>
<p>在<code>shell</code>中使用变量名的方式也是直接使用，例如<code>echo $ref</code>， 注意没有<code>点</code>。</p>
<p>配置完成后，保存，可以点击刚刚配置的<code>GitLab</code>的<code>webhook</code>页面的<code>Test</code>对应的事件测试。</p>
<p><code>GitLab</code>的<code>push</code>的<code>hook</code>数据：</p>
<pre tabindex="0"><code>{
  &#34;object_kind&#34;: &#34;push&#34;,
  &#34;before&#34;: &#34;95790bf891e76fee5e1747ab589903a6a1f80f22&#34;,
  &#34;after&#34;: &#34;da1560886d4f094c3e6c9ef40349f7d38b5d27d7&#34;,
  &#34;ref&#34;: &#34;refs/heads/master&#34;,
  &#34;checkout_sha&#34;: &#34;da1560886d4f094c3e6c9ef40349f7d38b5d27d7&#34;,
  &#34;user_id&#34;: 4,
  &#34;user_name&#34;: &#34;John Smith&#34;,
  &#34;user_username&#34;: &#34;jsmith&#34;,
  &#34;user_email&#34;: &#34;john@example.com&#34;,
  &#34;user_avatar&#34;: &#34;https://s.gravatar.com/avatar/d4c74594d841139328695756648b6bd6?s=8://s.gravatar.com/avatar/d4c74594d841139328695756648b6bd6?s=80&#34;,
  &#34;project_id&#34;: 15,
  &#34;project&#34;:{
    &#34;id&#34;: 15,
    &#34;name&#34;:&#34;Diaspora&#34;,
    &#34;description&#34;:&#34;&#34;,
    &#34;web_url&#34;:&#34;http://example.com/mike/diaspora&#34;,
    &#34;avatar_url&#34;:null,
    &#34;git_ssh_url&#34;:&#34;git@example.com:mike/diaspora.git&#34;,
    &#34;git_http_url&#34;:&#34;http://example.com/mike/diaspora.git&#34;,
    &#34;namespace&#34;:&#34;Mike&#34;,
    &#34;visibility_level&#34;:0,
    &#34;path_with_namespace&#34;:&#34;mike/diaspora&#34;,
    &#34;default_branch&#34;:&#34;master&#34;,
    &#34;homepage&#34;:&#34;http://example.com/mike/diaspora&#34;,
    &#34;url&#34;:&#34;git@example.com:mike/diaspora.git&#34;,
    &#34;ssh_url&#34;:&#34;git@example.com:mike/diaspora.git&#34;,
    &#34;http_url&#34;:&#34;http://example.com/mike/diaspora.git&#34;
  },
  &#34;repository&#34;:{
    &#34;name&#34;: &#34;Diaspora&#34;,
    &#34;url&#34;: &#34;git@example.com:mike/diaspora.git&#34;,
    &#34;description&#34;: &#34;&#34;,
    &#34;homepage&#34;: &#34;http://example.com/mike/diaspora&#34;,
    &#34;git_http_url&#34;:&#34;http://example.com/mike/diaspora.git&#34;,
    &#34;git_ssh_url&#34;:&#34;git@example.com:mike/diaspora.git&#34;,
    &#34;visibility_level&#34;:0
  },
  &#34;commits&#34;: [
    {
      &#34;id&#34;: &#34;b6568db1bc1dcd7f8b4d5a946b0b91f9dacd7327&#34;,
      &#34;message&#34;: &#34;Update Catalan translation to e38cb41.&#34;,
      &#34;timestamp&#34;: &#34;2011-12-12T14:27:31+02:00&#34;,
      &#34;url&#34;: &#34;http://example.com/mike/diaspora/commit/b6568db1bc1dcd7f8b4d5a946b0b91f9dacd7327&#34;,
      &#34;author&#34;: {
        &#34;name&#34;: &#34;Jordi Mallach&#34;,
        &#34;email&#34;: &#34;jordi@softcatala.org&#34;
      },
      &#34;added&#34;: [&#34;CHANGELOG&#34;],
      &#34;modified&#34;: [&#34;app/controller/application.rb&#34;],
      &#34;removed&#34;: []
    },
    {
      &#34;id&#34;: &#34;da1560886d4f094c3e6c9ef40349f7d38b5d27d7&#34;,
      &#34;message&#34;: &#34;fixed readme&#34;,
      &#34;timestamp&#34;: &#34;2012-01-03T23:36:29+02:00&#34;,
      &#34;url&#34;: &#34;http://example.com/mike/diaspora/commit/da1560886d4f094c3e6c9ef40349f7d38b5d27d7&#34;,
      &#34;author&#34;: {
        &#34;name&#34;: &#34;GitLab dev user&#34;,
        &#34;email&#34;: &#34;gitlabdev@dv6700.(none)&#34;
      },
      &#34;added&#34;: [&#34;CHANGELOG&#34;],
      &#34;modified&#34;: [&#34;app/controller/application.rb&#34;],
      &#34;removed&#34;: []
    }
  ],
  &#34;total_commits_count&#34;: 4
}
</code></pre>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/jenkins/">Jenkins</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/%E5%85%B3%E4%BA%8Ego-modules%E7%9A%84%E4%B8%80%E4%BA%9B%E5%86%85%E5%AE%B9/">
    <span class="title">« Prev</span>
    <br>
    <span>关于Go Modules的一些内容</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/jenkins%E4%B8%8Erocketchat%E9%9B%86%E6%88%90/">
    <span class="title">Next »</span>
    <br>
    <span>Jenkins与RocketChat集成</span>
  </a>
</nav>

  </footer><script
    src="https://giscus.app/client.js"
    data-repo="zzhaolei/zzhaolei.github.io"
    data-repo-id="R_kgDOMn_okw"
    data-category="Announcements"
    data-category-id="DIC_kwDOMn_ok84CiEHA"
    data-mapping="title"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="preferred_color_scheme"
    data-lang="zh-CN"
    crossorigin="anonymous"
    async
></script>

</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://localhost:1313/">俺的博客</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
